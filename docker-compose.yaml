services:
  postgres:
    image: ankane/pgvector:latest
    environment:
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_USER=postgres
      - POSTGRES_DB=eliza
      - PGDATA=/var/lib/postgresql/data/pgdata
    volumes:
      - postgres-data:/var/lib/postgresql/data:rw
    ports:
      - '5432:5432'
    healthcheck:
      test: ['CMD-SHELL', 'pg_isready -U $${POSTGRES_USER} -d $${POSTGRES_DB}']
      interval: 5s
      timeout: 5s
      retries: 5
    restart: always
    networks:
      - eliza-network
  elizaos:
    build:
      context: ./
      dockerfile: Dockerfile
    image: eliza-polkadot-assethub-agent:latest
    container_name: elizaos
    environment:

      - ASSET_HUB_PRIVATE_KEY=${ASSET_HUB_PRIVATE_KEY:-}
      - ASSET_HUB_RPC_URL=${ASSET_HUB_RPC_URL:-}
      - SUBSCAN_X_API_KEY=${SUBSCAN_X_API_KEY:-}


      # Core AI providers (at least one required)
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY:-}

      # Database (required for production)
      # - POSTGRES_URL=${POSTGRES_URL}

      # Server configuration
      - SERVER_PORT=${SERVER_PORT:-3000}
      - ELIZA_UI_ENABLE=${ELIZA_UI_ENABLE:-true}
      - NODE_ENV=${NODE_ENV:-production}
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - PGLITE_DATA_DIR=./.eliza/.elizadb
      #
      - OPENROUTER_API_KEY=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
      - OPENAI_API_KEY=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
      - ASSET_HUB_PRIVATE_KEY=0x139ace2d79edcd1af5f5449e784e48b147bdc0f22598fbb0fe3c3f0e02a5c451
    ports:
      - '3000:3000'
      # - '50000-50100:50000-50100/udp'
    depends_on:
      postgres:
        condition: service_healthy
    restart: always
    networks:
      - eliza-network

networks:
  eliza-network:
    driver: bridge
volumes:
  postgres-data:
